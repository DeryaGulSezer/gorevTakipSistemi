<div class="user-management-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>ğŸ‘¥ KullanÄ±cÄ± YÃ¶netimi</h1>
      <p>Sistem kullanÄ±cÄ±larÄ±nÄ± yÃ¶netin</p>
    </div>
    <div class="header-actions">
      <button 
        class="btn btn-primary" 
        (click)="toggleCreateForm()"
        [disabled]="loading">
        <span *ngIf="!showCreateForm">â• Yeni KullanÄ±cÄ±</span>
        <span *ngIf="showCreateForm">âŒ Ä°ptal</span>
      </button>
      <button 
        class="btn btn-secondary" 
        (click)="loadUsers()"
        [disabled]="loading">
        ğŸ”„ Yenile
      </button>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="tab-navigation">
    <button 
      class="tab-btn"
      [class.active]="activeTab === 'users'"
      (click)="switchTab('users')">
      ğŸ‘¥ KullanÄ±cÄ± YÃ¶netimi ({{ users.length }})
    </button>
    <button 
      class="tab-btn"
      [class.active]="activeTab === 'reports'"
      (click)="switchTab('reports')">
      âœ… Tamamlanan GÃ¶revler ({{ reportedTasks.length }})
    </button>
  </div>

  <!-- Mesajlar -->
  <div class="messages" *ngIf="error || success">
    <div class="alert alert-error" *ngIf="error">
      <span class="alert-icon">âš ï¸</span>
      {{ error }}
    </div>
    <div class="alert alert-success" *ngIf="success">
      <span class="alert-icon">âœ…</span>
      {{ success }}
    </div>
  </div>

  <!-- Users Tab -->
  <div class="tab-content" *ngIf="activeTab === 'users'">
    <!-- KullanÄ±cÄ± OluÅŸturma/DÃ¼zenleme Formu -->
    <div class="form-section" *ngIf="showCreateForm">
    <div class="form-card">
      <div class="form-header">
        <h2>{{ editingUser ? 'âœï¸ KullanÄ±cÄ± DÃ¼zenle' : 'â• Yeni KullanÄ±cÄ± OluÅŸtur' }}</h2>
      </div>
      
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
        <div class="form-row">
          <div class="form-group">
            <label for="username">KullanÄ±cÄ± AdÄ± *</label>
            <input 
              type="text" 
              id="username"
              formControlName="username"
              class="form-control"
              [class.error]="isFieldInvalid('username')"
              placeholder="kullanici_adi">
            <div class="error-message" *ngIf="isFieldInvalid('username')">
              {{ getFieldError('username') }}
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input 
              type="email" 
              id="email"
              formControlName="email"
              class="form-control"
              [class.error]="isFieldInvalid('email')"
              placeholder="email@domain.com">
            <div class="error-message" *ngIf="isFieldInvalid('email')">
              {{ getFieldError('email') }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fullName">Ad Soyad *</label>
            <input 
              type="text" 
              id="fullName"
              formControlName="fullName"
              class="form-control"
              [class.error]="isFieldInvalid('fullName')"
              placeholder="Ad Soyad">
            <div class="error-message" *ngIf="isFieldInvalid('fullName')">
              {{ getFieldError('fullName') }}
            </div>
          </div>

          <div class="form-group">
            <label for="role">Rol *</label>
            <select 
              id="role"
              formControlName="role"
              class="form-control"
              [class.error]="isFieldInvalid('role')">
              <option value="TEAM_MEMBER">ğŸ‘¤ Ekip Ãœyesi</option>
              <option value="MANAGER">ğŸ‘¨â€ğŸ’¼ MÃ¼dÃ¼r</option>
            </select>
            <div class="error-message" *ngIf="isFieldInvalid('role')">
              {{ getFieldError('role') }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="password">
              {{ editingUser ? 'Yeni Åifre (boÅŸ bÄ±rakÄ±lÄ±rsa deÄŸiÅŸtirilmez)' : 'Åifre *' }}
            </label>
            <input 
              type="password" 
              id="password"
              formControlName="password"
              class="form-control"
              [class.error]="isFieldInvalid('password')"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            <div class="error-message" *ngIf="isFieldInvalid('password')">
              {{ getFieldError('password') }}
            </div>
          </div>

          <div class="form-group" *ngIf="userForm.get('role')?.value === 'MANAGER'">
            <label for="managerType">Ne MÃ¼dÃ¼rÃ¼? *</label>
            <input 
              type="text" 
              id="managerType"
              formControlName="managerType"
              class="form-control"
              [class.error]="isFieldInvalid('managerType')"
              placeholder="Ã–rn: SatÄ±ÅŸ MÃ¼dÃ¼rÃ¼, YazÄ±lÄ±m MÃ¼dÃ¼rÃ¼">
            <div class="error-message" *ngIf="isFieldInvalid('managerType')">
              MÃ¼dÃ¼r tipi zorunludur.
            </div>
          </div>

          <div class="form-group" *ngIf="userForm.get('role')?.value === 'TEAM_MEMBER'">
            <label for="managerId">MÃ¼dÃ¼r *</label>
            <select 
              id="managerId"
              formControlName="managerId"
              class="form-control"
              [class.error]="isFieldInvalid('managerId')">
              <option value="">MÃ¼dÃ¼r seÃ§iniz...</option>
              <option *ngFor="let manager of managers" [value]="manager.id">
                {{ manager.fullName || manager.username }} 
                <span *ngIf="manager.managerType">({{ manager.managerType }})</span>
              </option>
            </select>
            <div class="error-message" *ngIf="isFieldInvalid('managerId')">
              Ekip Ã¼yesi iÃ§in mÃ¼dÃ¼r seÃ§imi zorunludur.
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="loading || !userForm.valid">
            <span *ngIf="!loading">{{ editingUser ? 'ğŸ’¾ GÃ¼ncelle' : 'â• OluÅŸtur' }}</span>
            <span *ngIf="loading">â³ {{ editingUser ? 'GÃ¼ncelleniyor...' : 'OluÅŸturuluyor...' }}</span>
          </button>
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="toggleCreateForm()"
            [disabled]="loading">
            âŒ Ä°ptal
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- KullanÄ±cÄ± Listesi -->
  <div class="list-section">
    <div class="list-header">
      <h2>ğŸ“‹ KullanÄ±cÄ± Listesi</h2>
      <span class="user-count">{{ users.length }} kullanÄ±cÄ±</span>
    </div>

    <!-- Loading -->
    <div class="loading" *ngIf="loading && users.length === 0">
      <div class="loading-spinner"></div>
      <p>KullanÄ±cÄ±lar yÃ¼kleniyor...</p>
    </div>

    <!-- KullanÄ±cÄ± Tablosu -->
    <div class="table-container" *ngIf="!loading || users.length > 0">
      <table class="users-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>KullanÄ±cÄ± AdÄ±</th>
            <th>Ad Soyad</th>
            <th>Email</th>
            <th>Rol</th>
            <th>MÃ¼dÃ¼r</th>
            <th>Durum</th>
            <th>Ä°ÅŸlemler</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users; trackBy: trackByUserId" class="user-row">
            <td class="user-id">{{ user.id }}</td>
            <td class="user-username">
              <strong>{{ user.username }}</strong>
            </td>
            <td class="user-fullname">{{ user.fullName }}</td>
            <td class="user-email">{{ user.email }}</td>
            <td class="user-role">
              <span class="role-badge" [ngClass]="getRoleBadgeClass(user.role)">
                {{ getRoleDisplayText(user.role) }}
                <span *ngIf="user.role === 'MANAGER' && user.managerType" class="manager-subtype">({{ user.managerType }})</span>
              </span>
            </td>
            <td class="user-manager">
              <span class="manager-info">
                {{ getManagerName(user) }}
              </span>
            </td>
            <td class="user-status">
              <span class="status-badge" [ngClass]="getUserStatusClass(user)">
                {{ getUserStatusText(user) }}
              </span>
            </td>
            <td class="user-actions">
              <button 
                class="btn btn-sm btn-edit"
                (click)="editUser(user)"
                [disabled]="loading"
                title="DÃ¼zenle">
                âœï¸
              </button>
              <button 
                class="btn btn-sm btn-delete"
                (click)="openDeleteModal(user)"
                [disabled]="loading || user.role === 'DIRECTOR'"
                [title]="user.role === 'DIRECTOR' ? 'DirektÃ¶r kullanÄ±cÄ±larÄ± silinemez' : 'Sil'">
                ğŸ—‘ï¸
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="users.length === 0 && !loading">
        <div class="empty-icon">ğŸ‘¥</div>
        <h3>KullanÄ±cÄ± bulunamadÄ±</h3>
        <p>HenÃ¼z hiÃ§ kullanÄ±cÄ± bulunmuyor.</p>
        <button class="btn btn-primary" (click)="toggleCreateForm()">
          â• Ä°lk kullanÄ±cÄ±yÄ± oluÅŸtur
        </button>
      </div>
    </div>
  </div>

  

  <!-- Silme Onay ModalÄ± -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ—‘ï¸ KullanÄ±cÄ±yÄ± Sil</h3>
        <button class="modal-close" (click)="closeDeleteModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p><strong>"{{ userToDelete?.username }}"</strong> kullanÄ±cÄ±sÄ±nÄ± silmek istediÄŸinizden emin misiniz?</p>
        <p class="warning">âš ï¸ Bu iÅŸlem geri alÄ±namaz!</p>
      </div>
      <div class="modal-actions">
        <button 
          class="btn btn-danger"
          (click)="confirmDelete()"
          [disabled]="loading">
          <span *ngIf="!loading">ğŸ—‘ï¸ Evet, Sil</span>
          <span *ngIf="loading">â³ Siliniyor...</span>
        </button>
        <button 
          class="btn btn-secondary"
          (click)="closeDeleteModal()"
          [disabled]="loading">
          âŒ Ä°ptal
        </button>
      </div>
    </div>
  </div>
  </div>
  <!-- End of Users Tab -->

  <!-- Reports Tab -->
  <div class="tab-content" *ngIf="activeTab === 'reports'">
    <div class="reports-section">
      <div class="reports-header">
        <h2>âœ… Tamamlanan GÃ¶revler</h2>
        <p>MÃ¼dÃ¼rlerin direktÃ¶re rapor ettiÄŸi tamamlanan gÃ¶revleri gÃ¶rÃ¼ntÃ¼leyin</p>
      </div>

      <!-- Reported Tasks List -->
      <div class="reported-tasks-list" *ngIf="reportedTasks.length > 0">
        <div class="table-container">
          <table class="tasks-table">
            <thead>
              <tr>
                <th>GÃ¶rev AdÄ±</th>
                <th>Atanan KiÅŸi</th>
                <th>Ã–ncelik</th>
                <th>Durum</th>
                <th>AÃ§Ä±klama</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let task of reportedTasks; trackBy: trackByTaskId">
                <td class="task-name">{{ task.isim }}</td>
                <td class="task-assignee">
                  <span class="user-badge">
                    {{ getAssignerName(task) }}
                  </span>
                </td>
                <td>
                  <span class="priority-badge" [class]="getPriorityClass(task.priority)">
                    {{ task.priority }}
                  </span>
                </td>
                <td>
                  <span class="status-badge" 
                        [class.completed]="task.status === 'COMPLETED'"
                        [class.archived]="task.status === 'ARCHIVED'">
                    {{ task.status === 'COMPLETED' ? 'âœ… TamamlandÄ±' : 
                       task.status === 'ARCHIVED' ? 'ğŸ“¦ ArÅŸivlendi' : task.status }}
                  </span>
                </td>
                <td class="task-description">{{ task.description }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- No Reports -->
      <div *ngIf="reportedTasks.length === 0" class="empty-state">
        <div class="empty-icon">âœ…</div>
        <h3>HenÃ¼z tamamlanan gÃ¶rev yok</h3>
        <p>MÃ¼dÃ¼rler gÃ¶revlerini tamamlayÄ±p direktÃ¶re rapor ettiklerinde burada gÃ¶rÃ¼necek</p>
        <button 
          class="btn btn-secondary"
          (click)="loadReportedTasks()">
          ğŸ”„ Yenile
        </button>
      </div>

    </div>
  </div>
  <!-- End of Reports Tab -->

</div>